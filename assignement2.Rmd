---
title: "assignement2_1"
author: "YANG Mengwei"
date: "10/8/2017"
output: html_document
---
##Exercice1

**Question 1a**

```{r}
source("function.R")
print(sum_column(iris, "Sepal.Length"))
print(sum_column(iris, "Species"))
print(sum_column(warpbreaks, "breaks"))
```

**Question 1b**

```{r}
source("function.R")
print(my_sum(iris$Sepal.Length))
print(sum_column(iris, "Species"))
print(sum_column(warpbreaks, "breaks"))
```

**Question 1c**

```{r}
source("function.R")
print(sum_divided_by(iris$Sepal.Length, 12))
print(sum_divided_by(iris$Species, 22))
print(sum_divided_by(iris$Sepal.Length, "Not numeric"))
print(sum_divided_by(warpbreaks$breaks, -12))
```

**Question 1d**
```{r}
source("function.R")
print(my_mean(iris$Sepal.Length))
print(my_mean(iris$Species))
print(my_mean(warpbreaks$breaks))
```

##Exercice2

**Question 2a**

```{r}
# Return a violin plot.
##ARGUMENTS:
# d: a data frame or tibble
# var: the name of a column of d containing the dependent variable, provided as a
# string
# grouping_var: the name of a column of d containing a grouping variable,
# provided as a string
##RETURN VALUE:
# A ggplot plot object containing a violin plot, grouped by the values
# of the grouping variable.
#

source("function.R")
print(grouped_violin_plot(iris, "Sepal.Length", "Species"))
```

```{r}
source("function.R")
p <- grouped_violin_plot(iris, "Sepal.Length", "Species")+ggplot2::scale_fill_brewer(palette ="PuBu")+ggplot2::labs(title="Iris Data")
print(p)

```

##Exercice3

**Question 3a**

Two ways to extract specific columns from a data frame: vector$columnName,vector[,c(columnName)],the second is more effictive,when use the first way (d$var) get the NULL


```{r}
# Difference in the medians between two groups.
##ARGUMENTS:
# d: a data frame or tibble
# var: the name of a column of d containing the dependent variable, provided as a string
# grouping_var: the name of a column of d containing a grouping variable, provided as a string
# group1: the value of grouping_var that corresponds to the first group
# group2: the value of grouping_var that corresponds to the second group
##RETURN VALUE:
# The median value of var for the first group, minus the median value of var for the second
# group.
#
source("function.R")

difference_in_medians(iris, "Sepal.Width", "Species", "versicolor", "virginica")
difference_in_medians(iris, "Sepal.Width", "Species", "virginica", "virginica")
```

**Question 3b**

```{r}
source("function.R")
iris$Sepal.Width[1:10]
if(!exists(".Random.seed")) set.seed(NULL)
previous_seed <- .Random.seed
set.seed(1)
randomize(iris, "Sepal.Width")$Sepal.Width[1:10]
randomize(iris, "Species")$Species[1:10]
randomize(iris, "Species")$Sepal.Width[1:10]
set.seed(previous_seed)
```

**Question 3c**

Don't understand the "Statictics",but it seems that the statistic return the real median while the n medians from the n times permutation, according the result we can campere these two statictics....

```{r}
source("function.R")
if(!exists(".Random.seed")) set.seed(NULL)
previous_seed <- .Random.seed
set.seed(1)
ptest_1 <- permutation_twogroups(iris, "Sepal.Width", "Species", "versicolor",
"virginica", difference_in_medians, n_samples=10)
ptest_2 <- permutation_twogroups(iris, "Sepal.Width", "Species", "versicolor",
"virginica", difference_in_medians, n_samples=10)
ptest_3 <- permutation_twogroups(randomize(iris, "Sepal.Width"), "Sepal.Width",
"Species", "versicolor", "virginica",
difference_in_medians, n_samples=10)
set.seed(previous_seed)
print(ptest_1)
print(ptest_2)
print(ptest_3)
print(ptest_3$observed)
print(ptest_3[["observed"]])
```

**Question 3d**
Does it matter for your permutation test whether you permute var or grouping_var? Why or why not?
I think that permuting the data of var is necessary, when the data is permuted, the data of each kind of iris is randomly distributed, so the versicolor may get the lenght of virginica, it's a kind of mixing, mixing all the species as one, at least we can take it as one specie, so the medians got in each permutation test is relatively like the medians data for one specie, once the data of var is permuted the grouping_var needn't any more permutation, because the data that the two groups got was alread distrubuted in the permutation of var.

**Question 3e**
```{r}
source("function.R")
if(!exists(".Random.seed")) set.seed(NULL)
previous_seed <- .Random.seed
set.seed(1)
ptest <- permutation_twogroups(iris, "Sepal.Width", "Species", "versicolor","virginica",difference_in_medians)
set.seed(previous_seed)
ptest_d <- tibble::as_tibble(ptest["permuted"])

p<-ggplot2::ggplot(ptest_d, ggplot2::aes_string(x="permuted",y="(..count..)"))+ggplot2::geom_histogram(fill="yellow",colour="black")+ggplot2::geom_vline(ggplot2::aes(xintercept=median(ptest$observed)))

print(p)
```
According to the histogramme, the real data median is very different than the permuted data medians, so we can say the two species of iris: Vericolor and Virginica have different sepal width, and we can distinguish these two species based on sepal width datas.


**Question 3f**

```{r}
source("function.R")
if(!exists(".Random.seed")) set.seed(NULL)
previous_seed <- .Random.seed
set.seed(1)
ptest_new <- permutation_twogroups(iris, "Sepal.Width", "Species", "versicolor",
"virginica", new_test_statistic)
set.seed(previous_seed)

ptest_d <- tibble::as_tibble(ptest_new["permuted"])
p_new<-ggplot2::ggplot(ptest_d, ggplot2::aes_string(x="permuted",y="(..count..)"))+ggplot2::geom_histogram(fill="grey",colour="black")+ggplot2::geom_vline(ggplot2::aes(xintercept=median(ptest_new$observed)))

print(p_new)

```
Different that the difference_in_medians before, my new_test_statistic take all the same arguments but return a stable number 0.1, so compare to the old graphe who describe the location of real median observed in the real word, this graphe describe the relation between a assuming median and the distribution of the medians of pretentiong one specie, this might present an evenment like: someone assume that in one specie the flower sepal width might have a difference of 0.1, but when he saw this graph he knows in reality the real flowers generally have the same sepal width, and the difference rarely bigger than 0.1.

**Question 3g**